<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>English Pronunciation Experiment</title>
    <style>
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(128, 90, 213, 0.7); }
            100% { box-shadow: 0 0 0 20px rgba(128, 90, 213, 0); }
        }
        @keyframes recording {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .hidden-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .visible-section {
            opacity: 1;
            transform: translateY(0);
        }

        #record-btn.animate-ping {
            opacity: 1;

        }

        #mouth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #mouth-image {
            width: 150px;
            height: 150px;
        }

        @keyframes spin-slow { to { transform: rotate(360deg) } }
        .animate-spin-slow { animation: spin-slow 2.5s linear infinite }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen bg-gray-100">


    <div class="fixed bottom-0 right-0 text-white grid grid-cols-1 gap-2 p-4 opacity-25">
        <div class="text-black p-2 rounded-lg">
            Dev. Tools
        </div>
        <button id="dev-failed" class="rounded bg-black py-1 px-2 hover:bg-gray-800">failed</button>
        <button id="dev-success" class="rounded bg-black py-1 px-2 hover:bg-gray-800">success</button>
        <button id="dev-loading" class="rounded bg-black py-1 px-2 hover:bg-gray-800">loading</button>
        <button id="dev-500" class="rounded bg-black py-1 px-2 hover:bg-gray-800">500</button>
    </div>


    <div class="mt-8 mb-8  bg-white rounded-3xl bg-white/70 backdrop-blur shadow-xl ring-1 ring-slate-200 md:w-1/3 p-8">

        <div class="overflow-hidden relative">

            <div id="btn-retry" class="absolute hidden bottom-8 md:bottom-16 text-center w-full z-10">
                <button class="text-center text-xl mx-auto px-4 py-4 bg-white text-purple-500 rounded-lg shadow-md hover:bg-purple-100 transition" id="retry-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="inline-block size-6 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
                      </svg>
                    Réessayer
                </button>
            </div>

        </div>

        <div class="px-6 ">

            <!-- start:loading -->
            <div id="loading" class="hidden text-center">
                <div class="mb-2 text-xl font-semibold text-purple-700">
                    Analyzing your speech...
                </div>
                <dotlottie-player src="https://lottie.host/9aa39c77-65e0-478e-8243-852870e49792/7GS38mSvBv.lottie" background="transparent" speed="1" style="margin: 0 auto; width: 300px; height: 300px" loop autoplay></dotlottie-player>
            </div>
            <!-- end:loading -->


            <!-- start:error -->
            <div id="error" class="hidden  text-center">
                <div class="mb-2">
                    <p class=" text-lg font-semibold text-red-600">
                        An error occurred.
                    </p>
                    <p class="mt-8">
                        Our service might be temporarily unavailable, or your internet connection is unstable. Please try again.
                    </p>
                </div>

                <dotlottie-player src="https://lottie.host/19ecd853-f89f-4b22-b152-d3d141794994/hrHxh5UYNa.lottie" background="transparent" speed="1" style="margin: 0 auto; width: 300px; height: 300px" loop autoplay></dotlottie-player>
            </div>
            <!-- end:error -->


            <!-- Speaking -->
            <div id="speaking" class="space-y-8">
                <header class="text-center">
                    <h2 class="text-xl font-semibold text-purple-700">
                        Pronounce the following text
                    </h2>
                </header>

                <div>
              <textarea id="expected-text" rows="3"
                        class="w-full rounded-2xl border border-slate-200 bg-white/70 p-4 text-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Saisis le texte à prononcer…">Hello, how are you?</textarea>
                </div>

                <div id="speaking-learn" class="text-center">
                    <p class="text-slate-500">
                        Listen to the correct pronunciation
                    </p>

                    <div id="mouth-container" class="mt-3 flex flex-col items-center justify-center">
                        <img id="viseme-image" alt="" class="rounded-xl w-32 h-32 object-contain" />
                    </div>
                    <button id="btn-read"
                            class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-900 text-white shadow hover:bg-slate-800">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 inline">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
                        </svg>

                         Listen
                    </button>
                </div>

                <p class="text-center text-slate-500">
                    When you're ready, press the button and start speaking.
                </p>

                <div id="speaking-speak" class="flex items-center justify-center pb-4">
                    <div class="relative flex items-center justify-center w-36 h-36">
                        <div id="progress-circle"
                             class="absolute inset-0 rounded-full border-4 border-purple-200 border-t-purple-600 animate-spin-slow"></div>
                        <button id="record-btn"
                                class="relative z-10 flex items-center justify-center w-16 h-16 rounded-full bg-purple-600 text-white shadow-lg hover:bg-purple-700">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z" />
                            </svg>

                        </button>
                    </div>
                </div>
            </div>
            <!-- end:speaking -->


            <!-- start:analysis-section -->
            <div id="analysis-section" class="mt-8 mb-8 hidden-section hidden">

                <div data-role="result.has-errors" class="hidden">
                    <p class="mt-2 text-2xl text-center font-semibold text-purple-600">
                        Score:
                    <span data-role="pronunciation.score">--</span></p>
    
                    <div class="mt-8" id="errors-card-section">
                        <h3 class="text-lg font-semibold text-gray-700 text-center">
                            Improve your pronunciation
                        </h3>
                        <p class="text-center text-gray-500" lang="en">
                            Practice pronouncing the following words correctly.
                        </p>
                        
                        <div id="errors-card-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6 mt-6">
                            <!-- Les cartes seront ajoutées ici dynamiquement -->
                        </div>

                        <div class="mt-16" data-role="pronunciation.chart">
                            <div class="text-lg font-semibold text-gray-700 text-center">
                                Statistics
                            </div>
                            <div class="mt-8">
                                <canvas
                                    class="h-12" 
                                    id="pronunciationChart"></canvas>
                            </div>
                        </div>

                        <div class="mt-16" data-role="prosodie.chart">
                            <div class="text-lg font-semibold text-gray-700 text-center" lang="en">
                                Rhythm and Intonation
                            </div>
                            <div class="mt-8">
                                <canvas id="prosodyChart" class="h-24"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Template pour générer dynamiquement les cartes -->
                    <template id="error-card-template">
                        <div class="card bg-white p-4 rounded-xl shadow-lg transform transition hover:scale-105 flex flex-col items-center text-center">
                            <div class="text-xl font-bold text-purple-700" data-role="word"></div>
                            <div class="text-gray-500 mt-1">
                                <span class="hidden text-red-600" data-role="actual"></span>
                                <span class="hidden  mx-2">→</span>
                                <span class="text-green-600 font-semibold" data-role="expected"></span>
                            </div>
                            <button class="play-audio mt-3 px-4 py-2 bg-purple-500 text-white rounded-lg shadow-md hover:bg-purple-600 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 inline">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
                                </svg>
                                Listen
                            </button>
                            <img class="viseme-img mt-4 w-24 h-24 rounded-lg cursor-pointer hover:opacity-80 transition" src="" alt="Visème">
                        </div>
                    </template>
                    
                    <!-- Template pour générer dynamiquement les erreurs -->
                    <template id="error-row-template">
                        <tr class="border border-gray-300">
                            <td class="border border-gray-300 px-4 py-2 font-semibold" data-role="word"></td>
                            <td class="hidden border border-gray-300 px-4 py-2 text-red-600" data-role="actual"></td>
                            <td class="border border-gray-300 px-4 py-2 text-green-600" data-role="expected"></td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                <img class="viseme-img w-24 h-24 rounded-lg cursor-pointer hover:opacity-75" src="" alt="Visème">
                            </td>
                        </tr>
                    </template>
    
                    <div class="mt-4 hidden">
                        <h3 class="text-lg font-semibold text-gray-700">Ce qu'un anglais aurait pu comprendre :</h3>
                        <p id="transcript" data-role="pronunciation.transcribe" class="mt-2 text-gray-600 italic">--</p>
                    </div>
                </div>
    
                <div data-role="result.no-errors" class="hidden text-center">
                    <p class="text-xl font-semibold text-green-600">
                        Well done! Your pronunciation is excellent.
                    </p>
                    <div>
                        <dotlottie-player src="https://lottie.host/e1b65ac5-e33d-4cfb-afd4-7d08ef57537c/7w8dOgAjIZ.lottie" background="transparent" speed="1" style="width: 300px; height: 300px;  margin: 0 auto" loop autoplay></dotlottie-player>
                        <!--<dotlottie-player src="https://lottie.host/b9c85163-edc7-415c-89ed-5c9d14cc6346/FJx54Ofwxr.lottie" background="transparent" speed="1" style="width: 300px; height: 300px; margin: 0 auto" loop autoplay></dotlottie-player>-->
                    </div>
                </div>
            </div>
            <!-- end:analysis-section -->



        </div>
    </div>


    
    
    <script src="/static/audio.js"></script>
    <script src="/static/viseme.js"></script>
    <script src="/static/ui.js"></script>

<script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>

</body>
</html>
